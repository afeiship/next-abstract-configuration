/*!
 * name: @jswork/next-abstract-configuration
 * description: Abstract configuration.
 * homepage: https://github.com/afeiship/next-abstract-configuration
 * version: 1.0.0
 * date: 2020-11-20 17:58:23
 * license: MIT
 */
!function(){var e=(this||window||Function("return this")()).nx||require("@jswork/next"),t=e.DataOperator||require("@jswork/next-object-operator"),n=e.deepEach||require("@jswork/next-deep-each"),r=e.secretTmpl||require("@jswork/next-secret-tmpl"),o=require("fs"),i={path:"",context:e.noop},s=/\${{(.*?)}}/,u=e.declare("nx.AbstractConfiguration",{methods:{init:function(t){this.options=e.mix(null,i,this.defaults(),t),this.reload()},"set,sets,get,gets":function(e){return function(){var t=this.operator;return t[e].apply(t,arguments)}},reload:function(){this.data=this.load(),this.transform(),this.operator=new t(this.data)},update:function(t){this.sets(t),this.save()},save:function(){var t=this.dump();o.writeFileSync(this.options.path,t)},defaults:function(){return null},load:function(){return null},dump:function(){return""},transform:function(){var o=this.context(),t=this.data;n(t,function(t,e,n){"string"==typeof e&&s.test(e)&&(n[t]=r(e,o)||e)})},context:function(){return e.mix({env:process.env},this.options.context())}}});"undefined"!=typeof module&&module.exports&&(module.exports=u)}();