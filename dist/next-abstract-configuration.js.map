{"version":3,"sources":["next-abstract-configuration.js"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"next-abstract-configuration.js","sourcesContent":["(function () {\n  var global = global || this || window || Function('return this')();\n  var nx = global.nx || require('@feizheng/next-js-core2');\n  var NxDataOperator = nx.DataOperator || require('@feizheng/next-object-operator');\n  var nxDeepEach = nx.deepEach || require('@feizheng/next-deep-each');\n  var nxSecretTmpl = nx.secretTmpl || require('@feizheng/next-secret-tmpl');\n  var fs = require('fs');\n  var DEFAULT_OPTIONS = { path: '', context: nx.noop };\n  var VAR_RE = /\\${{(.*?)}}/;\n\n  var NxAbstractConfiguration = nx.declare('nx.AbstractConfiguration', {\n    methods: {\n      init: function (inOptions) {\n        this.options = nx.mix(null, DEFAULT_OPTIONS, this.defaults(), inOptions);\n        this.reload();\n      },\n      'set,sets,get,gets': function (name) {\n        return function () {\n          var ctx = this.operator;\n          return ctx[name].apply(ctx, arguments);\n        }\n      },\n      reload: function () {\n        this.data = this.load();\n        this.transform();\n        this.operator = new NxDataOperator(this.data);\n      },\n      update: function (inObject) {\n        this.sets(inObject);\n        this.save();\n      },\n      save: function () {\n        var str = this.dump();\n        fs.writeFileSync(this.options.path, str);\n      },\n      defaults: function () {\n        // @ template method\n        return null;\n      },\n      load: function () {\n        // @ template method\n        return null;\n      },\n      dump: function () {\n        // @ template method\n        return '';\n      },\n      transform: function () {\n        var ctx = this.context();\n        var data = this.data;\n        nxDeepEach(data, function (key, value, parent) {\n          if (typeof value === 'string' && VAR_RE.test(value)) {\n            parent[key] = nxSecretTmpl(value, ctx) || value\n          }\n        });\n      },\n      context: function () {\n        return nx.mix(\n          {\n            env: process.env\n          },\n          this.options.context()\n        );\n      }\n    }\n  });\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = NxAbstractConfiguration;\n  }\n})();\n"]}